'''
Created on 5 Mar 2020

@author: pipertod
'''
import unittest
from virustotal.VirusTotal import VirusTotalClient 
from test.TestHelper import TestHelper

class VirusTotalTest(unittest.TestCase):

    def setUp(self):

        self.pythonFile = "./testfiles/jmespath-0.9.4-py2.py3-none-any.whl"
        
        self.testHelper = TestHelper()
        
        fileLogHandler = self.testHelper.getFileLogHandler("./logs/virus-total-test.log")
        
        self.virusTotalClient = VirusTotalClient(fileLogHandler, self.testHelper.getMockRequestHandler())
        
    def tearDown(self):
        pass

    def testFileNotFound(self):
        
        self.testHelper.setResponse_FileNotFound()
        
        responseData = self.virusTotalClient.checkFileHash("./testfiles/embedded-base64-script-test-file.py")
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert responseData.isSuspicious()
        assert not responseData.isMalware()
        
    def testMalwareFound(self):
        
        self.testHelper.setResponse_MalwareReputation()
        
        responseData = self.virusTotalClient.checkFileHash("./testfiles/embedded-base64-script-test-file.py")
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert responseData.isSuspicious()
        assert responseData.isMalware()
        
    def testSafeFile(self):
        
        self.testHelper.setResponse_CleanReputation()
        
        responseData = self.virusTotalClient.checkFileHash("./testfiles/embedded-base64-script-test-file.py")
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert not responseData.isSuspicious()
        assert not responseData.isMalware()

if __name__ == "__main__":
    # import sys;sys.argv = ['', 'Test.testName']
    unittest.main()
