'''
Created on 5 Mar 2020

@author: pipertod
'''
import unittest
from nvd.NVDClient import NVDClient 
from test.TestHelper import TestHelper
from unittest.mock import Mock

class NVDClient(unittest.TestCase):

    def setUp(self):

        self.safeKeyword = "numpy"
        
        self.unknownKeyword = "blah"
        
        self.malwareKeyword = "numpy"
        
        self.testHelper = TestHelper()
        
        fileLogHandler = self.testHelper.getFileLogHandler("./logs/nvd-test.log")
        requestHandler = self.testHelper.getMockRequestHandler()
        
        assert fileLogHandler
        assert requestHandler
        self.nvdClient=NVDClient(fileLogHandler,requestHandler)
        
    def tearDown(self):
        pass

    def testFileNotFound(self):
        
        #self.testHelper.setResponse_FileNotFound()
        
        responseData = self.nvdClient.checkLibraryName(self.unknownKeyword)
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert responseData.isSuspicious()
        assert not responseData.isMalware()
        
    def testMalwareFound(self):
        
        #self.testHelper.setResponse_MalwareFile()
        
        responseData = self.nvdClient.checkLibraryName(self.malwareKeyword)
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert responseData.isSuspicious()
        assert responseData.isMalware()
        
    def testSafeFile(self):
        #self.testHelper.setResponse_CleanFile()
        
        responseData = self.nvdClient.checkLibraryName(self.safeKeyword)
        
        assert responseData
        
        print("ResponseData: \n" + responseData.toJSON())
        
        assert not responseData.isSuspicious()
        assert not responseData.isMalware()

if __name__ == "__main__":
    # import sys;sys.argv = ['', 'Test.testName']
    unittest.main()
