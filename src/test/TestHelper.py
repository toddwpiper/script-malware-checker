'''
Created on 5 Mar 2020

@author: pipertod
'''
import json
from unittest.mock import Mock
import logging

class TestHelper(object):
    '''
    classdocs
    '''


    def __init__(self):
        '''
        Constructor
        '''
        self.requestHandler = Mock()
        self.responseMock = Mock()
        self.responseMock.status_code = 200
        
        self.setResponse_CleanReputation()
        
        self.requestHandler.retrieve_report.return_value = self.responseMock
        
    def getFileLogHandler(self, filepath):
        filelogHandler = logging.FileHandler(filepath)
        filelogHandler.setFormatter(logging.Formatter("[%(asctime)s %(levelname)s] %(message)s", datefmt="%m/%d/%Y %I:%M:%S"))
        return filelogHandler
        
    def getMockRequestHandler(self):
        return self.requestHandler
    
    def setResponse_NoReputation(self):
        
        responseDict = {
            "response_code": 0,
            "resource": "9aa7c17674aa00d5314d8ac889598546997d4066fe22215137c9a3cb252c2482",
            "verbose_msg": "The  requested resource is not among the finished, queued or pending scans"
            }
    
        self.responseMock.text = json.dumps(responseDict, indent=2)

        
    def setResponse_CleanReputation(self):
        
        responseDict = {
            
            "scans": {
                "McAfee": {
                    "detected": False,
                    "version": "6.0.6.653",
                    "result": None,
                    "update": "20200217"
                    }
                },
            "scan_id": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a-1582116706",
            "sha1": "ba8e2e9e137f962d75cd840539506517fddefbe7",
            "resource": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a",
            "response_code": 1,
            "scan_date": "2020-02-19 12:51:46",
            "permalink": "https://www.virustotal.com/file/39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a/analysis/1582116706/",
            "verbose_msg": "Scan finished, information embedded",
            "total": 1,
            "positives": 0,
            "sha256": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a",
            "md5": "b9d0e0840e3e6e37f384a794d48c4ae8"
        }
        
        self.responseMock.text = json.dumps(responseDict, indent=2)

        
    def setResponse_MalwareReputation(self):
        
        responseDict =  {
            "scans": {
                "McAfee": {
                    "detected": True,
                    "version": "6.0.6.653",
                    "result": "Found virus blahblahblah",
                    "update": "20200217"
                    }
                },
            "scan_id": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a-1582116706",
            "sha1": "ba8e2e9e137f962d75cd840539506517fddefbe7",
            "resource": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a",
            "response_code": 1,
            "scan_date": "2020-02-19 12:51:46",
            "permalink": "https://www.virustotal.com/file/39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a/analysis/1582116706/",
            "verbose_msg": "Scan finished, information embedded",
            "total": 1,
            "positives": 1,
            "sha256": "39d2c685af15d3ce682c99ce5925cc66efc824652e10990d2462dfe9b8918c6a",
            "md5": "b9d0e0840e3e6e37f384a794d48c4ae8"
        }
            
        self.responseMock.text = json.dumps(responseDict, indent=2)
